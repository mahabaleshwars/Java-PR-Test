name: Test Caching Scenarios

on:
  push: 
    branches: [main]
  pull_request:
  workflow_dispatch: 

jobs:
  # Scenario:  Caching enabled (default behavior)
  cache-enabled-default:
    name: Cache Enabled (Default)
    runs-on: ubuntu-latest
    steps: 
      - uses:  actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - name: Setup Gradle with default caching
        uses: gradle/actions/setup-gradle@v5

      - name: Run Gradle build
        run: ./gradlew build

  # Scenario:  Disable caching
  cache-disabled:
    name: Cache Disabled
    runs-on: ubuntu-latest
    steps: 
      - uses:  actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - name: Setup Gradle with caching disabled
        uses: gradle/actions/setup-gradle@v5
        with: 
          cache-disabled: true

      - name: Run Gradle build
        run:  ./gradlew build

  # Scenario: Cache read-only mode
  cache-read-only:
    name: Cache Read-Only
    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@v4
      - uses:  actions/setup-java@v4
        with:
          distribution: temurin
          java-version:  17

      - name: Setup Gradle with read-only cache
        uses: gradle/actions/setup-gradle@v5
        with:
          cache-read-only:  true

      - name: Run Gradle build
        run: ./gradlew build

  # Scenario:  Cache read-only for non-main branches
  cache-read-only-conditional:
    name:  Cache Read-Only (Conditional)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with: 
          distribution: temurin
          java-version: 17

      - name: Setup Gradle with conditional read-only cache
        uses: gradle/actions/setup-gradle@v5
        with:
          cache-read-only:  ${{ github.ref != 'refs/heads/main' && github.ref != 'refs/heads/release' }}

      - name: Run Gradle build
        run: ./gradlew build

  # Scenario:  Cache write-only mode
  cache-write-only:
    name: Cache Write-Only
    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@v4
      - uses:  actions/setup-java@v4
        with:
          distribution: temurin
          java-version:  17

      - name: Setup Gradle with write-only cache
        uses: gradle/actions/setup-gradle@v5
        with:
          cache-write-only: true

      - name: Run Gradle build
        run:  ./gradlew build

  # Scenario: Cache cleanup options
  cache-cleanup-options:
    name: Cache Cleanup - ${{ matrix.cleanup }}
    strategy:
      matrix:
        cleanup:  [always, on-success, never]
    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@v4
      - uses:  actions/setup-java@v4
        with:
          distribution: temurin
          java-version:  17

      - name: Setup Gradle with cache-cleanup ${{ matrix.cleanup }}
        uses: gradle/actions/setup-gradle@v5
        with:
          cache-cleanup: ${{ matrix.cleanup }}

      - name:  Run Gradle build
        run: ./gradlew build

  # Scenario:  Cache overwrite existing
  cache-overwrite-existing:
    name: Cache Overwrite Existing
    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@v4
      - uses:  actions/setup-java@v4
        with:
          distribution: temurin
          java-version:  17

      - name: Setup Gradle with cache overwrite
        uses:  gradle/actions/setup-gradle@v5
        with: 
          cache-overwrite-existing: true

      - name: Run Gradle build
        run: ./gradlew build

  # Scenario: Include/exclude cache content
  cache-include-exclude:
    name: Cache Include/Exclude Paths
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          distribution:  temurin
          java-version: 17

      - name: Setup Gradle with custom cache paths
        uses: gradle/actions/setup-gradle@v5
        with: 
          gradle-home-cache-includes: |
            caches
            notifications
            jdks
          gradle-home-cache-excludes: |
            caches/build-cache-1
            caches/keyrings

      - name: Run Gradle build
        run: ./gradlew build